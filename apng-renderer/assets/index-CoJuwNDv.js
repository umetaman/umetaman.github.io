(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const c of s)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function e(s){const c={};return s.integrity&&(c.integrity=s.integrity),s.referrerPolicy&&(c.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?c.credentials="include":s.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(s){if(s.ep)return;s.ep=!0;const c=e(s);fetch(s.href,c)}})();const g=[137,80,78,71,13,10,26,10];var m=(r=>(r[r.None=0]="None",r[r.Background=1]="Background",r[r.Previous=2]="Previous",r))(m||{}),y=(r=>(r[r.Source=0]="Source",r[r.Over=1]="Over",r))(y||{});const N=r=>r.slice(0,g.length).every((e,n)=>e===g[n]),C=r=>{if(N(r)==!1)throw new Error("This is not PNG");const t=new DataView(r.buffer),e=[];let n=g.length;for(;n<r.length;){const s=t.getUint32(n);n+=4;const c=t.buffer.slice(n,n+4),i=String.fromCharCode(...new Uint8Array(c));n+=4;const a=r.slice(n,n+s);n+=s;const o=r.slice(n,n+4);switch(n+=4,i){case"IHDR":const u=V(a);e.push({length:s,type:i,content:u,crc:o});break;case"IDAT":const p={data:a};e.push({length:s,type:i,content:p,crc:o});break;case"acTL":const L=O(a);e.push({length:s,type:i,content:L,crc:o});break;case"fcTL":const k=R(a);e.push({length:s,type:i,content:k,crc:o});break;case"fdAT":const D=S(a);e.push({length:s,type:i,content:D,crc:o});break;default:e.push({length:s,type:i,content:a,crc:o})}}return e},V=r=>{const t=new DataView(r.buffer),e=t.getUint32(0),n=t.getUint32(4),s=t.getUint8(8),c=t.getUint8(9),i=t.getUint8(10),a=t.getUint8(11),o=t.getUint8(12);return{width:e,height:n,bitDepth:s,colorType:c,compressionMethod:i,filterMethod:a,interlaceMethod:o}},O=r=>{const t=new DataView(r.buffer),e=t.getUint32(0),n=t.getUint32(4);return{numFrames:e,numPlays:n}},R=r=>{const t=new DataView(r.buffer),e=t.getUint32(0),n=t.getUint32(4),s=t.getUint32(8),c=t.getUint32(12),i=t.getUint32(16),a=t.getUint16(20),o=t.getUint16(22),u=t.getUint8(24),p=t.getUint8(25);return{sequenceNumber:e,width:n,height:s,xOffset:c,yOffset:i,delayNum:a,delayDen:o,disposeOp:u,blendOp:p}},S=r=>({sequenceNumber:new DataView(r.buffer).getUint32(0),data:r.slice(4)}),M=3988292384,E=new Uint32Array(256);for(let r=0;r<256;r++){let t=r;for(let e=0;e<8;e++)(t&1)===1?t=t>>>1^M:t=t>>>1;E[r]=t}const f=r=>{let t=4294967295;for(let e=0;e<r.length;e++)t=t>>>8^E[(t^r[e])&255];return t=t^4294967295,t},U=4,P=13,H=(r,t)=>{const e={...r};return e.width=t.width,e.height=t.height,e},q=r=>{r.set(g,0)},v=r=>new Uint8Array(r.split("").map(t=>t.charCodeAt(0))),G=(r,t,e)=>{const n=new DataView(r.buffer);n.setUint32(e,P),e+=4,r.set(v("IHDR"),e),e+=4,n.setUint32(e,t.width),e+=4,n.setUint32(e,t.height),e+=4,n.setUint8(e,t.bitDepth),e+=1,n.setUint8(e,t.colorType),e+=1,n.setUint8(e,t.compressionMethod),e+=1,n.setUint8(e,t.filterMethod),e+=1,n.setUint8(e,t.interlaceMethod),e+=1;const s=f(r.slice(e-P-U,e));n.setUint32(e,s)},B=(r,t,e)=>{const n=new DataView(r.buffer);n.setUint32(e,t.length),e+=4,r.set(v("IDAT"),e),e+=4,r.set(t,e),e+=t.length;const s=f(r.slice(e-t.length-U,e));n.setUint32(e,s)},_=(r,t)=>{const e=new DataView(r.buffer);e.setUint32(t,0),t+=4,r.set(v("IEND"),t),t+=4;const n=f(r.slice(t-U,t));e.setUint32(t,n)},j=r=>{const t=45+r.data.length+12;return new Uint8Array(t)};class Y{chunks;numFrames=0;numPlays=0;ihdr;frames=[];get playCount(){return this.numPlays}get frameCount(){return this.numFrames}constructor(t){if(this.chunks=C(t),!this.chunks)throw new Error("Failed to read chunks");if(this.chunks[0].type!=="IHDR")throw new Error("IHDR not found");this.ihdr=this.chunks[0].content;const e=this.chunks.find(c=>c.type==="acTL");if(!e)throw new Error("acTL not found");const n=e.content;this.numFrames=n.numFrames,this.numPlays=n.numPlays;let s={control:void 0,content:void 0};for(let c=0;this.chunks[c].type!=="IEND";c++){const i=this.chunks[c];i.type=="fcTL"&&(s.control=i.content),i.type=="fdAT"&&(s.content=i.content),i.type=="IDAT"&&(s.content=i.content),s.control&&s.content&&(this.frames.push(s),s={})}console.assert(this.frames.length==this.numFrames)}createCanvasElement(){const t=document.createElement("canvas");return t.width=this.ihdr.width,t.height=this.ihdr.height,t}dispose(t,e){const n=e.getContext("2d");if(!n)throw new Error("Failed to get 2d context");if(t<1)return;const s=Math.max(0,t-1),c=this.frames[t],i=this.frames[s];switch(c.control.disposeOp){case m.None:break;case m.Background:n.clearRect(0,0,n.canvas.width,n.canvas.height);break;case m.Previous:i.image&&n.drawImage(i.image,i.control.xOffset,i.control.yOffset);break}}blend(t,e){const n=e.getContext("2d");if(!n)throw new Error("Failed to get 2d context");if(t<1)return;const s=Math.max(0,t-1),c=this.frames[t],i=this.frames[s];switch(c.control.blendOp){case y.Source:n.clearRect(0,0,n.canvas.width,n.canvas.height);break;case y.Over:i.image&&n.drawImage(i.image,i.control.xOffset,i.control.yOffset);break}}renderFrame(t,e){const n=this.frames[t],s=n.image;if(!s)throw new Error("Image not loaded");const c=e.getContext("2d");if(!c)throw new Error("Failed to get 2d context");c.drawImage(s,n.control.xOffset,n.control.yOffset)}async loadAsync(){const t=[];for(let e=0;e<this.frames.length;e++){const n=this.frames[e];if(n.content){const s=this.buildPNG(n.control,n.content),c=new Blob([s],{type:"image/png"}),i=URL.createObjectURL(c),a=new Image;a.src=i;const o=new Promise(u=>{a.onload=()=>{n.image=a,u()}});t.push(o)}}await Promise.all(t)}buildPNG(t,e){const n=j(e),s=H(this.ihdr,t);let c=0;return q(n),c+=8,G(n,s,c),c+=25,B(n,e.data,c),c+=8+e.data.length+4,_(n,c),n}}class T{renderer;canvas;index=0;isPlaying=!1;constructor(t,e){this.renderer=t,this.canvas=e}play(t){this.isPlaying=!0;let e=performance.now();const n=1e3/t,s=()=>{if(!this.isPlaying)return;const c=performance.now();c-e>=n&&(this.renderer.dispose(this.index,this.canvas),this.renderer.blend(this.index,this.canvas),this.renderer.renderFrame(this.index,this.canvas),this.index=(this.index+1)%this.renderer.frameCount,e=c),requestAnimationFrame(s)};requestAnimationFrame(s)}stop(){this.isPlaying=!1}}const A=""+new URL("apng-Cy0aw9uM.png",import.meta.url).href,Z=await fetch(A),$=new Uint8Array(await Z.arrayBuffer()),w=new Y($);await w.loadAsync();const h=document.getElementById("app"),I=w.createCanvasElement();h==null||h.appendChild(I);const F=30;let d=new T(w,I);d.play(30);const b=document.createElement("span");b.textContent=`FPS: ${F}`;h==null||h.appendChild(b);const l=document.createElement("input");l.type="range";l.min="10";l.max="90";l.value=F.toString();h==null||h.appendChild(l);l.addEventListener("input",()=>{b.textContent=`FPS: ${l.value}`});l.addEventListener("change",()=>{d==null||d.stop(),d=null,d=new T(w,I),requestAnimationFrame(()=>{d==null||d.play(parseInt(l.value,10)),console.log(parseInt(l.value,10))})});const x=document.createElement("img");x.src=A;h==null||h.appendChild(x);
